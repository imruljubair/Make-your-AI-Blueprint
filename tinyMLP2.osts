{"version":"0.3.0","body":"function main(workbook: ExcelScript.Workbook) {\n    const designSheet = workbook.getWorksheet(\"Architect\");\n    const range = designSheet.getRange(\"A2:C30\");\n    const statusRange = designSheet.getRange(\"D2:D30\");\n    const values = range.getValues();\n    const allInputs = values.map(row => row[0]);\n    const allOperations = values.map(row => row[1]);\n    const allOutputs = values.map(row => row[2]);\n\n    designSheet.getCell(0, 4).setValue(\"\");\n    statusRange.clear(ExcelScript.ClearApplyTo.all);\n\n\n    // console.log(allOutputs);\n\n    // Create or clear the \"ABH\" worksheet\n    let abhSheet = workbook.getWorksheet(\"Blueprint\");\n    if (abhSheet) {\n        abhSheet.getUsedRange()?.clear();\n    } else {\n        abhSheet = workbook.addWorksheet(\"Blueprint\");\n    }\n    let W = 20\n    let H = 17;\n    let shapeLeftRightPos = W;\n    let shapeBottomTopPos = H;\n    let shapeWidth = 50;\n    let shapeHeight = 20;\n    abhSheet.setShowGridlines(false);\n    abhSheet.setShowHeadings(true);\n    abhSheet.getRange().getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.center);\n    abhSheet.getRange().getFormat().setVerticalAlignment(ExcelScript.VerticalAlignment.center);\n\n    abhSheet.getRange().getFormat().setColumnWidth(W);\n    abhSheet.getRange().getFormat().setRowHeight(H);\n    abhSheet.getRange().getFormat().getFont().setName(\"Ink Free\");\n    abhSheet.getRange().getFormat().getFont().setSize(7);\n    abhSheet.getRange().getFormat().getFont().setBold(false);\n    // const usedRange = abhSheet.getUsedRange();\n    // if (usedRange) {\n\n    // }\n\n\n    // Delete all shapes from the worksheet\n    const allShapes = abhSheet.getShapes();\n    for (let shape of allShapes) {\n        shape.delete();\n    }\n\n    // const regex_2 = /^(\\w+),\\s*dim\\s*=\\s*(\\d+)$/i;\n    // const nums: number[] = [];\n    // for (let i = 0; i < allOutputs.length; i++) {\n    //     const cellValue = String(allOutputs[i]).trim();\n    //     // console.log(cellValue);\n    //     const match = cellValue.match(regex_2);\n    //     if (match) {\n    //         const num = Number(match[2]);\n    //         nums.push(num);\n    //     }\n    // }\n\n    // const maxDim = Math.max(...nums);\n    const colStart = 2;\n\n    // Cursor stored as an object so we can mutate it anywhere\n    let cursor = { row: 1, col: colStart, range };\n    let blockStartCursor = { row: 1, col: 2, range };\n    let blockEndCursor = { row: 1, col: 2, range };\n\n    let T = 0;\n    let d = 0;\n    let hasInput: boolean = false;\n    let namedVariable = \"X\";\n    let output_var_name = \"X\";\n    let dim_var_name = \"d\";\n    let dim_value = 1;\n    let temprange: ExcelScript.Range;\n    let currentShape: ExcelScript.Shape;\n    let prevShape: ExcelScript.Shape;\n\n\n    let params: { [key: string]: [string, number] } = {};  // Regex to match \", dim d=3\"\n    const regex = /^(\\w+),?\\s*dim\\s+(\\w+)\\s*=\\s*(\\d+)/i;\n    \n\n    for (let i = 0; i < allOutputs.length; i++) {\n        const cellValue = String(allOutputs[i]).trim();\n        // console.log(cellValue);\n        const match = cellValue.match(regex);\n        if (match) {\n            const outVarName = match[1];\n            const key = match[2];\n            const num = Number(match[3]);\n            params[outVarName] = [key, num];\n        }\n        // else if(match2){\n\n        // }\n        else {\n            const simpleMatch = cellValue.match(/^(\\w+)$/);\n            if (simpleMatch) {\n                const outVarName = simpleMatch[1];\n                // Only add if not already present\n                if (!(outVarName in params)) {\n                    params[outVarName] = [\"\", 1];\n                }\n            }\n        }\n\n    }\n\n    let numberOfClasses = 0;\n    let samplesPerClasses = 0;\n    let imRow = 0;\n    let imCol = 0;\n\n    // console.log(\"Max dim =\", maxNum);\n\n    let ops_var_temp = \"\";\n\n    // âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸\n    // âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸ï¸âš ï¸âš ï¸âš ï¸ Loop:Start âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸\n    // âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸âš ï¸\n\n    for (let i = 0; i < values.length; i++) {\n\n\n        blockStartCursor = cursor;\n\n        const row = values[i];\n        const input = row[0] as string;\n        const operation = row[1] as string;\n        const output = row[2] as string;\n        let input_var_name = \"\";\n        let input_string = \"\";\n        let out_dim = 1;\n\n        const regex_dim = /^(\\w+),?\\s*dim\\s+(\\w+)\\s*=\\s*(\\d+)/i;\n        const regex_dim2 = /^(\\w+),\\s*dim\\s*=\\s*(\\d+)$/i;\n\n        const match = output.match(regex_dim);\n        const match2 = output.match(regex_dim2);\n        if (match) {\n            out_dim = Number(match[3]);\n        }\n        else if (match2){\n            \n        out_dim = Number(match2[2]);\n        // console.log(out_dim);\n          \n        }\n\n        if (input == \"\") {\n            fullCompleteMessage(designSheet, 0, 4);\n            break;\n        }\n\n\n        // âœ…âœ…âœ…âœ… if:input âœ…âœ…âœ…âœ… \n\n        if (input) {\n\n            const input_token_match = input.match(/^([^=]+)=([^=]+)$/);\n            \n            if (input_token_match) {\n                const xd = 1;\n                input_var_name = input_token_match[1].trim();\n                input_string = input_token_match[2].trim();\n                T = input_string.length;\n                namedVariable = input_var_name;\n                cursor = drawXwithText(abhSheet, input_var_name, input_string, cursor.row, cursor.col, xd, T);\n\n                updateName(workbook, cursor, output_var_name);\n                let range_: ExcelScript.Range;\n                range_ = cursor.range;\n                let tcode = getCode(range_, input_var_name, output_var_name, cursor.row, cursor.col, xd, T);\n                const cc = cursor.col + (T + 2);\n                const cr = cursor.row - (xd + 1);\n                abhSheet.getCell(cr, cc).setValue(tcode);\n                abhSheet.getCell(cr, cc).getFormat().getFont().setName(\"Courier New\");\n                abhSheet.getCell(cr, cc).getFormat().getFont().setColor(\"gray\");\n                abhSheet.getCell(cr, cc).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n\n\n            }\n            else {\n                input_var_name = input;\n            }\n\n          const input_token_match_im = input.match(/(\\w+)\\s*=\\s*(\\w+)\\s*,\\s*batch\\s*=\\s*(\\d+)/i);\n\n        // âœ…âœ…âœ…âœ… if:imageinput âœ…âœ…âœ…âœ… \n\n            if (input_token_match_im) {\n                \n              input_var_name = input_token_match_im[1];\n              const datasetName = input_token_match_im[2];\n              const batchNumber = Number(input_token_match_im[3]);\n              T = batchNumber;\n            const datasetInfo = getDatasetInfo(workbook, datasetName);\n            numberOfClasses = Number(datasetInfo[\"class\"])\n            samplesPerClasses = Number(datasetInfo[\"samples\"])\n            imRow = Number(datasetInfo[\"rows\"]);\n            imCol = Number(datasetInfo[\"cols\"]);\n\n                const regex_2 = /^(\\w+),\\s*dim\\s*=\\s*(\\d+)$/i;\n                const nums: number[] = [];\n                nums.push(imRow*imCol);\n                for (let i = 0; i < allOutputs.length; i++) {\n                    const cellValue = String(allOutputs[i]).trim();\n                    // console.log(cellValue);\n                    const match = cellValue.match(regex_2);\n                    if (match) {\n                        const num = Number(match[2]);\n                        nums.push(num);\n                    }\n                }\n\n                const maxDim = Math.max(...nums);\n                cursor.col = maxDim+3;\n\n                const next_ops = values[i][1] as string;\n                const includeBias = next_ops === \"Linear\";\n\n                cursor = displayImages(abhSheet, \n                                    input_var_name +\" = \"+datasetName, \n                                    cursor.row, cursor.col, \n                                    datasetName, \n                                    numberOfClasses,\n                                    samplesPerClasses,\n                                    batchNumber, \n                                    imRow, imCol,\n                                    includeBias);\n                \n              updateName(workbook, cursor, input_var_name);\n                // cursor.col = maxDim + 3;\n                // cursor.col = cursor.col - maxDim;\n\n            }\n\n        }\n\n        // const range = drawBlockBorder(i, abhSheet, input_var_name, operation, cursor.row, cursor.col);\n        // cursor.row += 2;\n        \n\n\n        // âœ…âœ…âœ…âœ… if:output âœ…âœ…âœ…âœ… \n        if (output) {\n            const output_match = output.match(/^(\\w+),\\s*dim\\s+(\\w+)\\s*=\\s*(\\d+)$/i);\n            const output_match2 = output.match(/^(\\w+),\\s*dim\\s*=\\s*(\\d+)$/i);\n            if (output_match) {\n                output_var_name = output_match[1];\n                dim_var_name = output_match[2];\n                dim_value = Number(output_match[3]);\n\n                namedVariable = output_var_name;\n            }\n            else if (output_match2){\n                output_var_name = output_match2[1];\n                // dim_var_name = output_match[2];\n                dim_value = Number(output_match2[2]);\n                // console.log(dim_value);\n\n                namedVariable = output_var_name;\n            }\n            else {\n                output_var_name = output;\n                namedVariable = output_var_name;\n            }\n            // let d1 = params[output_var_name][1];\n            let d1=out_dim;\n\n\n\n            // âœ…âœ…âœ…âœ… if:Flatten âœ…âœ…âœ…âœ… \n            if (operation == \"Flatten\")\n            {\n              if (i+1 < values.length){\n                const next_ops = values[i+1][1] as string;\n                // if (next_ops.match(/^W\\*([A-Za-z]+)\\+b$/)){\n                if (next_ops == \"Linear\") {\n                  const r = workbook.getNamedItem(input_var_name).getRange();\n                    cursor = Flattening(abhSheet,\n                        changeTitle2(output_var_name, operation, input_var_name),\n                        cursor.row, cursor.col,\n                        r,\n                        imRow,imCol,\n                        T);\n                  updateName(workbook, cursor, output_var_name);\n                }\n                else{\n                  const r = workbook.getNamedItem(input_var_name).getRange();\n                  cursor = Flattening(abhSheet, input_var_name, cursor.row, cursor.col, r, 5, 5, T, false);\n                  updateName(workbook, cursor, output_var_name);\n                }\n              }\n            }\n\n\n            // âœ…âœ…âœ…âœ… if:Embed âœ…âœ…âœ…âœ… \n            if (operation == \"Embed\") {\n                const commCell = abhSheet.getCell(cursor.row - 2, cursor.col - 1);\n                // abhSheet.addComment(commCell, \"-\");\n\n                cursor = drawMatrix(abhSheet, changeTitle2(output_var_name, operation, input_var_name), cursor.row, cursor.col, d1, T, \"random\");\n                updateName(workbook, cursor, output_var_name);\n\n                let cr = cursor.row - (d1 + 1);\n                let cc = cursor.col + (T + 2);\n                let codeString = `${output_var_name} = nn.Embedding((26, ${d1})(${input_var_name})`;\n\n                abhSheet.getCell(cr, cc).setValue(codeString);\n                abhSheet.getCell(cr, cc).getFormat().getFont().setName(\"Courier New\");\n                abhSheet.getCell(cr, cc).getFormat().getFont().setColor(\"gray\");\n                abhSheet.getCell(cr, cc).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n                // write1DnumParams(abhSheet, dim_var_name, d, cursor, d, T);\n                // console.log(ops_var_temp);\n                // prevShape = currentShape;\n            }\n\n            // âœ…âœ…âœ…âœ… if:PE+ âœ…âœ…âœ…âœ… \n            else if (operation == \"PE+\") {\n\n                const commCell = abhSheet.getCell(cursor.row - 2, cursor.col - 1);\n                // abhSheet.addComment(commCell, \"-\");\n\n                cursor = drawMatrix(abhSheet, \"Positions\", cursor.row, cursor.col, 1, T, \"seq\");\n                cursor = drawMatrix(abhSheet, \"PE\", cursor.row, cursor.col, d1, T, \"random\");\n                updateName(workbook, cursor, \"PE\");\n                const range1 = workbook.getNamedItem(output_var_name).getRange();\n                let range2: ExcelScript.Range;\n                range2 = cursor.range;\n                cursor = add2Matrices(abhSheet, range1, range2, changeTitle2(output_var_name, operation, input_var_name), cursor.row, cursor.col, d1, T);\n                updateName(workbook, cursor, output_var_name);\n\n\n            }\n\n            // âœ…âœ…âœ…âœ… if:LayerNorm âœ…âœ…âœ…âœ… \n            else if (operation == \"LayerNorm\") {\n                const commCell = abhSheet.getCell(cursor.row - 2, cursor.col - 1);\n                // abhSheet.addComment(commCell, \"-\");\n\n                // const r = workbook.getNamedItem(input_var_name).getRange();\n                // const rows = r.getRowCount();\n                // // const cola = r.getColumnCount();\n                // cursor = LayerNorm(abhSheet, changeTitle2(output_var_name, operation, input_var_name), cursor.row, cursor.col, r, rows, T);\n                // updateName(workbook, cursor, output_var_name);\n\n              const r = workbook.getNamedItem(input_var_name).getRange();\n              const rows = r.getRowCount();\n                T = r.getColumnCount();\n\n\n              const next_ops = values[i + 1][1] as string;\n\n              const includeBias = next_ops === \"Linear\";\n              cursor = LayerNorm(abhSheet, changeTitle2(output_var_name, operation, input_var_name), cursor.row, cursor.col, r, rows, T, includeBias);\n              updateName(workbook, cursor, output_var_name);\n            }\n\n\n            // âœ…âœ…âœ…âœ… if:ReLU âœ…âœ…âœ…âœ… \n            else if (operation == \"ReLU\") {\n                const commCell = abhSheet.getCell(cursor.row - 2, cursor.col - 1);\n                // abhSheet.addComment(commCell, \"-\");\n\n                const r = workbook.getNamedItem(input_var_name).getRange();\n                const rows = r.getRowCount();\n                T = r.getColumnCount();\n\n\n                const next_ops = values[i + 1][1] as string;\n                const includeBias = next_ops === \"Linear\";\n\n                cursor = ReLU(abhSheet, changeTitle2(output_var_name, operation, input_var_name), cursor.row, cursor.col, r, rows, T, includeBias);\n                updateName(workbook, cursor, output_var_name);\n                \n\n                // if (next_ops == \"Linear\") {\n                //     const r = workbook.getNamedItem(input_var_name).getRange();\n                //     cursor = ReLU(abhSheet, changeTitle2(output_var_name, operation, input_var_name), cursor.row, cursor.col, r, rows, T);\n                //     updateName(workbook, cursor, output_var_name);\n                // }\n                // else {\n                //     const r = workbook.getNamedItem(input_var_name).getRange();\n                //     cursor = ReLU(abhSheet, changeTitle2(output_var_name, operation, input_var_name), cursor.row, cursor.col, r, rows, T, false);\n                //     updateName(workbook, cursor, output_var_name);\n                // }\n\n            }\n\n\n            // âœ…âœ…âœ…âœ… if:L1-Normalize âœ…âœ…âœ…âœ… \n            else if (operation == \"L1-Normalize\") {\n                const r = workbook.getNamedItem(input_var_name).getRange();\n                const rows = r.getRowCount();\n                // const cola = r.getColumnCount();\n                cursor = L1Normalization(abhSheet, changeTitle2(output_var_name, operation, input_var_name), cursor.row, cursor.col, r, rows, T);\n                updateName(workbook, cursor, output_var_name);\n            }\n\n \n            // âœ…âœ…âœ…âœ… if:L2-Normalize âœ…âœ…âœ…âœ… \n            else if (operation == \"L2-Normalize\") {\n                const r = workbook.getNamedItem(input_var_name).getRange();\n                const rows = r.getRowCount();\n                // const cola = r.getColumnCount();\n                cursor = L2Normalization(abhSheet, changeTitle2(output_var_name, operation, input_var_name), cursor.row, cursor.col, r, rows, T);\n                updateName(workbook, cursor, output_var_name);\n            }\n\n\n            // âœ…âœ…âœ…âœ… if:Softmax âœ…âœ…âœ…âœ… \n            else if (operation == \"Softmax\") {\n                const commCell = abhSheet.getCell(cursor.row - 2, cursor.col - 1);\n                // abhSheet.addComment(commCell, \"-\");\n\n                const r = workbook.getNamedItem(input_var_name).getRange();\n                const rows = r.getRowCount();\n                T = r.getColumnCount();\n\n\n                const next_ops = values[i + 1][1] as string;\n                const includeBias = next_ops === \"Linear\";\n\n                // const cola = r.getColumnCount();\n                // console.log(changeTitle2(output_var_name, operation, input_var_name));\n                cursor = softmax(abhSheet,\n                    changeTitle2(output_var_name, operation, input_var_name),\n                    cursor.row, cursor.col,\n                    r,\n                    rows, T, \n                    includeBias);\n\n                updateName(workbook, cursor, output_var_name);\n            }\n\n\n            // âœ…âœ…âœ…âœ… if:Linear âœ…âœ…âœ…âœ… \n            else if (operation == \"Linear\"){\n                // output_var_name = output_match2[1];\n                // // dim_var_name = output_match2[2];\n                // dim_value = Number(output_match2[2]);\n                // namedVariable = output_var_name;\n                // const d2 = params[output_var_name][1];\n\n                const next_ops = values[i + 1][1] as string;\n\n                const includeBias = next_ops === \"Linear\";\n\n                const d2 = out_dim;\n                // const d2 = dim_value;\n                // console.log(d1)\n                const range1 = workbook.getNamedItem(input_var_name).getRange();\n                d1 = range1.getRowCount();\n                T = range1.getColumnCount();\n                // console.log(d1)\n                cursor.col = cursor.col - (d1+1);\n                cursor = drawMatrix(abhSheet, \"Weights\", cursor.row, cursor.col, d2, d1, \"random\");\n                updateName(workbook, cursor, \"Weights\");\n                cursor.row = cursor.row - (d2 + 2);\n                cursor.col = cursor.col + (d1 + 1);\n                const range2 = workbook.getNamedItem(\"Weights\").getRange();\n                cursor = multMatricesWithRand2(abhSheet, range2, range1, d1, d2, T, changeTitle2(output_var_name, operation, input_var_name), cursor.row, cursor.col, includeBias);\n                cursor.col = cursor.col - (d1 + 1);\n                updateName(workbook, cursor, output_var_name);\n                cursor.col = cursor.col + (d1+1);\n            }\n            \n            // âœ…âœ…âœ…âœ… if:* âœ…âœ…âœ…âœ… \n            else if (operation.includes(\"*\") && input_var_name in params) {\n                const output_match = output.match(/^(\\w+),\\s*dim\\s+(\\w+)\\s*=\\s*(\\d+)$/i);\n\n\n                // console.log(\"-->\"+input_var_name);\n                // if(input_var_name in params){\n                let range1 = workbook.getNamedItem(input_var_name).getRange();\n                const rows = range1.getRowCount();\n                let d1 = params[input_var_name][1];\n                d1= rows;\n                // }\n                let d2 = 0;\n                //   let d_ = 0;\n                if (output_match && !(operation.replace(/\\*/g, \"\") in params)) {\n                    output_var_name = output_match[1];\n                    dim_var_name = output_match[2];\n                    dim_value = Number(output_match[3]);\n                    namedVariable = output_var_name;\n                    d2 = params[output_var_name][1];\n                    cursor = drawMatrix(abhSheet, operation.replace(/\\*/g, \"\"), cursor.row, cursor.col, d2, d1, \"random\");\n                    updateName(workbook, cursor, operation.replace(/\\*/g, \"\"));\n                    cursor.row = cursor.row - (d2 + 2);\n                    cursor.col = cursor.col + (d1 + 1);\n                    const range2 = workbook.getNamedItem(operation.replace(/\\*/g, \"\")).getRange();\n                    cursor = multMatricesWithRand(abhSheet, range2, range1, d1, d2, T, changeTitle2(output_var_name, operation, input_var_name), cursor.row, cursor.col);\n                    cursor.col = cursor.col - (d1 + 1);\n                    updateName(workbook, cursor, output_var_name);\n                }\n\n                const ops_match = operation.match(/\\b([A-Za-z])\\^T\\*/);\n                if (ops_match) {\n                    const ops_var = ops_match[1];\n                    if (ops_var in params) {\n                        d2 = params[ops_var][1];\n                        const r = workbook.getNamedItem(ops_var).getRange();\n                        cursor = transposeMatrix(abhSheet, r, operation.replace(/\\*/g, \"\"), ops_var, cursor.row, cursor.col, T, d2);\n                        updateName(workbook, cursor, operation.replace(/[^A-Za-z0-9_]/g, \"\"));\n                        cursor.row = cursor.row - (T + 2);\n                        cursor.col = cursor.col + (d1 + 1);\n                        const range2 = workbook.getNamedItem(operation.replace(/[^A-Za-z0-9_]/g, \"\")).getRange();\n                        cursor = multMatricesWithRand(abhSheet, range2, range1, T, T, T, changeTitle2(output_var_name, operation, input_var_name), cursor.row, cursor.col);\n                        cursor.col = cursor.col - (d1 + 1);\n                        updateName(workbook, cursor, output_var_name);\n\n                    }\n                }\n\n                // const ops_match2 = operation.match(/^(\\w+)\\*$/);\n                const ops_match2 = operation.match(/^W\\*[A-Za-z]+(\\+b)?$/);\n                if (ops_match2) {\n                    // console.log(input_var_name);\n\n                    const ops_var = ops_match2[1];\n                    if (ops_var in params) {\n                        d2 = params[ops_var][1];\n                        const r = workbook.getNamedItem(ops_var).getRange();\n                        // cursor = transposeMatrix(abhSheet, r, operation.replace(/\\*/g, \"\"), ops_var, cursor.row, cursor.col, T, d2);\n                        // const range1 = workbook.getNamedItem(operation.replace(/[^A-Za-z0-9_]/g, \"\")).getRange();\n                        cursor = drawMatrix(abhSheet, operation.replace(/[^A-Za-z0-9_]/g, \"\"), cursor.row, cursor.col, d2, T, \"other\", r);\n                        updateName(workbook, cursor, operation.replace(/[^A-Za-z0-9_]/g, \"\"));\n                        cursor.row = cursor.row - (d2 + 2);\n                        cursor.col = cursor.col + (T + 1);\n                        const range2 = workbook.getNamedItem(operation.replace(/[^A-Za-z0-9_]/g, \"\")).getRange();\n                        cursor = multMatricesWithRand(abhSheet, range2, range1, T, d2, T, changeTitle2(output_var_name, operation, input_var_name), cursor.row, cursor.col);\n                        cursor.col = cursor.col - (T + 1);\n                        updateName(workbook, cursor, output_var_name);\n\n                    }\n                }\n\n\n\n\n            }\n\n            // console.log(blockStartCursor.col + \", \" + blockEndCursor.col);\n\n        }\n\n        doneMessage(i, designSheet, 3);\n        blockEndCursor = cursor;\n        // console.log(blockStartCursor.row + \", \" + blockEndCursor.row);\n\n\n\n    }\n\n// ðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œ\n// ðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œ Loop:End  ðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œ\n// ðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œðŸ›œ\n\n\n}\n\n\n\n\n// ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨\n// ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ Function Block ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨\n// ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨ðŸŸ¨\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:moveCursor ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction moveCursor(cursor: { row: number; col: number }, r: number, c: number) {\n    cursor.row += r;\n    cursor.col += c;\n}\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:UpdateName ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction updateName(\n    workbook: ExcelScript.Workbook,\n    cursor: { row: number; col: number; range: ExcelScript.Range },\n    namedVariable: string\n) {\n\n    let temprange: ExcelScript.Range;\n    temprange = cursor.range;\n    let allNames = workbook.getNames();\n\n    allNames.forEach(n => {\n        if (n.getName() === namedVariable) {\n            n.delete();\n        }\n    });\n\n    workbook.addNamedItem(namedVariable, temprange);\n\n}\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:convertToA1 ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction convertToA1(row: number, column: number): string {\n    let columnLabel = \"\";\n    column = column + 1;\n    row = row + 1;\n    while (column > 0) {\n        column--;\n        columnLabel = String.fromCharCode(65 + (column % 26)) + columnLabel;\n        column = Math.floor(column / 26);\n    }\n    return `${columnLabel}${row}`;\n}\n\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:doImageFormatting ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction doImageFormatting(\n    sheet: ExcelScript.Worksheet,\n    cursorrow: number,\n    cursorcol: number,\n    number_of_rows: number,\n    number_of_cols: number,\n    lastRowOne: boolean = false\n){\n    // const range = sheet.getRange(\n    //     convertToA1(cursorrow, cursorcol) + \":\" + convertToA1(cursorrow + number_of_rows - 1, cursorcol + number_of_cols - 1)\n    // );\n    \n    // range.clearAllConditionalFormats();\n\n    const rowsForFormatting = lastRowOne ? number_of_rows - 1 : number_of_rows;\n    let range = sheet.getRange(\n        convertToA1(cursorrow, cursorcol) + \":\" +\n        convertToA1(cursorrow + rowsForFormatting - 1, cursorcol + number_of_cols - 1)\n    );\n\n    range.clearAllConditionalFormats();\n\n    // \n    // Add color scale conditional formatting\n    const colorScale = range.addConditionalFormat(ExcelScript.ConditionalFormatType.colorScale);\n    const cf = colorScale.getColorScale();\n\n    cf.setCriteria({\n        minimum: {\n            type: ExcelScript.ConditionalFormatColorCriterionType.number,\n            formula: \"0\",\n        color: \"dimgray\" // black\n        },\n        maximum: {\n            type: ExcelScript.ConditionalFormatColorCriterionType.number,\n            formula: \"1\",\n            color: \"WhiteSmoke\" // white\n        }\n    });\n\n    const fmt = range.getFormat();\n    const borders = [\n        ExcelScript.BorderIndex.edgeTop,\n        ExcelScript.BorderIndex.edgeBottom,\n        ExcelScript.BorderIndex.edgeLeft,\n        ExcelScript.BorderIndex.edgeRight,\n        // ExcelScript.BorderIndex.insideVertical,\n        // ExcelScript.BorderIndex.insideHorizontal,\n    ];\n\n    for (let b of borders) {\n        fmt.getRangeBorder(b).setStyle(ExcelScript.BorderLineStyle.continuous);\n        fmt.getRangeBorder(b).setWeight(2);\n        fmt.getRangeBorder(b).setColor(\"black\");\n    }\n\n    range = sheet.getRange(\n        convertToA1(cursorrow, cursorcol) + \":\" + convertToA1(cursorrow + number_of_rows - 1, cursorcol + number_of_cols - 1)\n    );\n\n\n    return range;\n}\n\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:doConditionalFormatting ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction doConditionalFormatting(\n    sheet: ExcelScript.Worksheet,\n    cursorrow: number,\n    cursorcol: number,\n    number_of_rows: number,\n    number_of_cols: number,\n    lowColor: string = \"#2C7BB6\",\n    highColor: string = \"#D7191C\",\n    vertEdge: boolean = true,\n    horEdge: boolean = false,\n    lastRowOne: boolean = false\n\n) {\n    // const range = sheet.getRange(\n    //     convertToA1(cursorrow, cursorcol) + \":\" + convertToA1(cursorrow + number_of_rows - 1, cursorcol + number_of_cols - 1)\n    // );\n    const rowsForFormatting = lastRowOne ? number_of_rows - 1 : number_of_rows;\n    let range = sheet.getRange(\n        convertToA1(cursorrow, cursorcol) + \":\" +\n        convertToA1(cursorrow + rowsForFormatting - 1, cursorcol + number_of_cols - 1)\n    );\n\n    range.clearAllConditionalFormats();\n\n    // \n    // Add color scale conditional formatting\n    const colorScale = range.addConditionalFormat(ExcelScript.ConditionalFormatType.colorScale);\n    const cf = colorScale.getColorScale();\n\n    cf.setCriteria({\n        minimum: {\n            type: ExcelScript.ConditionalFormatColorCriterionType.lowestValue,\n            // formula: \"0\",\n            // color: \"#353839\" // black\n            color: lowColor\n        },\n        midpoint: {\n            type: ExcelScript.ConditionalFormatColorCriterionType.percentile,\n            formula: \"50\",\n            // color: \"#F5F5F5\" // white\n            color: \"WhiteSmoke\"\n        },\n        maximum: {\n            type: ExcelScript.ConditionalFormatColorCriterionType.highestValue,\n            // formula: \"1\",\n            // color: \"#F5F5F5\" // white\n            color: highColor\n        }\n    });\n\n    const fmt = range.getFormat();\n\n    let borders = [\n        ExcelScript.BorderIndex.edgeTop,\n        ExcelScript.BorderIndex.edgeBottom,\n        ExcelScript.BorderIndex.edgeLeft,\n        ExcelScript.BorderIndex.edgeRight,\n        ExcelScript.BorderIndex.insideVertical,\n        ExcelScript.BorderIndex.insideHorizontal,\n    ];\n\n    if (horEdge){\n    borders = [\n        ExcelScript.BorderIndex.edgeTop,\n        ExcelScript.BorderIndex.edgeBottom,\n        ExcelScript.BorderIndex.edgeLeft,\n        ExcelScript.BorderIndex.edgeRight,\n        // ExcelScript.BorderIndex.insideVertical,\n        ExcelScript.BorderIndex.insideHorizontal,\n    ];}\n    \n    if(vertEdge){\n    borders = [\n        ExcelScript.BorderIndex.edgeTop,\n        ExcelScript.BorderIndex.edgeBottom,\n        ExcelScript.BorderIndex.edgeLeft,\n        ExcelScript.BorderIndex.edgeRight,\n        ExcelScript.BorderIndex.insideVertical,\n        // ExcelScript.BorderIndex.insideHorizontal,\n    ];}\n\n    for (let b of borders) {\n        fmt.getRangeBorder(b).setStyle(ExcelScript.BorderLineStyle.continuous);\n        // fmt.getRangeBorder(b).setWeight(2);\n        fmt.getRangeBorder(b).setColor(\"black\");\n    }\n\n\n\n    // range2.clearAllConditionalFormats();\n    // if (lastRowOne) {\n    //     const lastRowRange = sheet.getRange(\n    //         convertToA1(cursorrow + number_of_rows - 1, cursorcol) + \":\" +\n    //         convertToA1(cursorrow + number_of_rows - 1, cursorcol + number_of_cols - 1)\n    //     );\n\n    //     // Remove conditional formatting from ONLY the last row\n        \n    // }\n\n    range = sheet.getRange(\n        convertToA1(cursorrow, cursorcol) + \":\" + convertToA1(cursorrow + number_of_rows - 1, cursorcol + number_of_cols - 1)\n    );\n\n    return range;\n}\n\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:doFormatting ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction doFormatting(\n    sheet: ExcelScript.Worksheet,\n    cursorrow: number,\n    cursorcol: number,\n    number_of_rows: number,\n    number_of_cols: number,\n    color: string,\n) {\n    const range = sheet.getRange(\n        convertToA1(cursorrow, cursorcol) + \":\" + convertToA1(cursorrow + number_of_rows - 1, cursorcol + number_of_cols - 1)\n    );\n\n    const fmt = range.getFormat();\n    const borders = [\n        ExcelScript.BorderIndex.edgeTop,\n        ExcelScript.BorderIndex.edgeBottom,\n        ExcelScript.BorderIndex.edgeLeft,\n        ExcelScript.BorderIndex.edgeRight,\n        ExcelScript.BorderIndex.insideVertical,\n        ExcelScript.BorderIndex.insideHorizontal,\n    ];\n\n    for (let b of borders) {\n        fmt.getRangeBorder(b).setStyle(ExcelScript.BorderLineStyle.continuous);\n        // fmt.getRangeBorder(b).setWeight(2);\n        fmt.getRangeBorder(b).setColor(\"gray\");\n    }\n\n    fmt.getFill().setColor(color);\n\n    return range;\n}\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:embedViaLookUp ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction embedViaLookUp(\n    tokens: string,\n    sheet: ExcelScript.Worksheet,\n    inputRange: ExcelScript.Range\n) {\n    const dim = 3; // number of elements per embedding\n    const lookup = lookUp();\n    const embedMat: number[][] = Array.from({ length: dim }, () => []);\n\n    for (const token of tokens) {\n        const vec = lookup[token];\n        if (vec) {\n            for (let i = 0; i < dim; i++) embedMat[i].push(vec[i]);\n        } else {\n            // handle unknown token\n            for (let i = 0; i < dim; i++) embedMat[i].push(0);\n        }\n    }\n\n    return embedMat;\n}\n\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:displayImages ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction displayImages(\n    sheet: ExcelScript.Worksheet,\n    header: string,\n    cursorrow: number,\n    cursorcol: number,\n    // in_range: ExcelScript.Range,\n\n    dataset: string,\n    n_class: number,\n    n_smpls: number,\n    n_batch: number,\n\n    number_of_rows: number,\n    number_of_cols: number,\n\n    ones: boolean = false\n    \n){\n    sheet.getCell(cursorrow, cursorcol).setValue(header);\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setSize(12);\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setBold(true);\n\n    sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n\n    cursorrow += 1;\n\n    let rand_cls = 0;\n    let rand_smpls = 0;\n\n    let formula_ = `=RANDBETWEEN(0,${n_class-1})`;\n    let formula_s = `=RANDBETWEEN(0,${n_smpls-1})`;\n    let shiftright = 1;\n    let shiftdown = 0;\n    let gap = 0;\n    let n_rows_withones = 0;\n\n    for (let b = 0; b < n_batch; b++){\n\n        rand_cls = Math.floor(Math.random() * n_class);\n        rand_smpls = Math.floor(Math.random() * n_smpls);\n        \n        shiftdown = 0;\n        sheet.getCell(cursorrow + shiftdown, shiftright + cursorcol + (number_of_cols + gap) * b).setValue(\"[\"+String(b+1)+\"]\");\n        sheet.getCell(cursorrow + shiftdown, shiftright + cursorcol + (number_of_cols + gap) * b).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n        \n        shiftdown = 1;\n        sheet.getCell(cursorrow + shiftdown, shiftright + cursorcol + (number_of_cols + gap) * b-1).setValue(\"class:\");\n        sheet.getCell(cursorrow + shiftdown, shiftright + cursorcol + (number_of_cols + gap) * b).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.right);\n        sheet.getCell(cursorrow + shiftdown, shiftright + cursorcol + (number_of_cols + gap) *b).setValue(rand_cls);\n        sheet.getCell(cursorrow + shiftdown, shiftright + cursorcol + (number_of_cols + gap) * b).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n\n\n        shiftdown = 2;\n        sheet.getCell(cursorrow + shiftdown, shiftright + cursorcol + (number_of_cols + gap) * b-1).setValue(\"sample:\");\n        sheet.getCell(cursorrow + shiftdown, shiftright + cursorcol + (number_of_cols + gap) * b - 1).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.right);\n        sheet.getCell(cursorrow + shiftdown, shiftright + cursorcol + (number_of_cols + gap) *b).setValue(rand_smpls);\n        sheet.getCell(cursorrow + shiftdown, shiftright + cursorcol + (number_of_cols + gap) * b).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n\n      // console.log(convertToA1(cursorrow+1, cursorcol));\n\n        let formula_im = ``;\n        formula_im = `=OFFSET(${dataset}!C4,${number_of_rows + 2}*${convertToA1(cursorrow + 1, shiftright + cursorcol + (number_of_cols + gap) * b)},${number_of_cols + 2}*${convertToA1(cursorrow + 1 + 1, shiftright + cursorcol + (number_of_cols + gap) * b)}, ${number_of_rows}, ${number_of_cols})`;\n\n        formula_im = ones ? `=VSTACK(${formula_im.substring(1)}, SEQUENCE(1,${number_of_cols})*0+1)` : formula_im;\n        n_rows_withones = ones ? 1 : 0;\n\n      \n        // cursorcol += shiftright;\n        shiftdown = 3;\n        sheet\n            .getCell(cursorrow + shiftdown, (shiftright - 1) + cursorcol + (number_of_cols + gap) *b)\n            .setFormula(formula_im);\n\n        const range = doImageFormatting(sheet, \n                                cursorrow + shiftdown, \n                                (shiftright - 1) + cursorcol + (number_of_cols + gap) *b,\n                                number_of_rows + 1 * n_rows_withones, \n                                number_of_cols,\n                                ones);\n\n\n\n    }\n\n\n  cursorrow+=3;\n\n  const range = sheet.getRange(\n      convertToA1(cursorrow, cursorcol) + \":\" + convertToA1(cursorrow + number_of_rows - 1, cursorcol + (number_of_cols + gap) * n_batch - (gap+1))\n  );\n\n    cursorrow = cursorrow + number_of_rows + 1 + 1 * n_rows_withones;\n    \n\n    return { row: cursorrow, col: cursorcol, range };\n}\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:drawMatrix ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction drawMatrix(\n    sheet: ExcelScript.Worksheet,\n    header: string,\n    cursorrow: number,\n    cursorcol: number,\n    number_of_rows: number,\n    number_of_cols: number,\n    randorseq: string,\n    in_range?: ExcelScript.Range\n) {\n\n    sheet.getCell(cursorrow, cursorcol).setValue(header);\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setSize(12);\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setBold(true);\n\n    sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n    cursorrow += 1;\n    let formula_ = ``;\n    let color = \"#daf2d1\";\n    if (randorseq == \"random\") {\n        formula_ = `=RANDARRAY(${number_of_rows}, ${number_of_cols}, -1, 1)`\n        color = \"yellow\";\n    }\n    else if (randorseq == \"seq\") {\n        formula_ = `=SEQUENCE(${number_of_rows}, ${number_of_cols}, 0)`\n        color = \"white\";\n    }\n    else if (randorseq == \"other\") {\n        formula_ = `=${in_range.getAddress()}`;\n    }\n\n    sheet\n        .getCell(cursorrow, cursorcol)\n        .setFormula(formula_);\n\n    // const range = doFormatting(sheet, cursorrow, cursorcol, number_of_rows, number_of_cols, color);\n    const range = doConditionalFormatting(sheet,\n    cursorrow, cursorcol,\n    number_of_rows, number_of_cols,\n    \"orange\", \"yellow\",\n    false, true);\n    cursorrow += number_of_rows + 1;\n\n    return { row: cursorrow, col: cursorcol, range };\n\n}\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:ABCto123 ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction ABCto123(sheet: ExcelScript.Worksheet,\n  header: string,\n  cursorrow: number,\n  cursorcol: number,\n  in_range: ExcelScript.Range,\n  number_of_rows: number,\n  number_of_cols: number,\n) {\n\n  // sheet.getCell(cursorrow, cursorcol).setValue(header);\n  sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n\n  // cursorrow += 1;\n  let formula_ = ``;\n  formula_ = `=CODE(LOWER(${in_range.getAddress()}))- CODE(\"a\")`;\n  sheet\n    .getCell(cursorrow, cursorcol)\n    .setFormula(formula_);\n\n  const range = doFormatting(sheet, cursorrow, cursorcol, number_of_rows, number_of_cols, \"#d5a6bd\");\n  cursorrow += number_of_rows + 1;\n\n  return { row: cursorrow, col: cursorcol, range };\n\n}\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:Flattening ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction Flattening(sheet: ExcelScript.Worksheet,\n  header: string,\n  cursorrow: number,\n  cursorcol: number,\n  in_range: ExcelScript.Range,\n  number_of_rows: number,\n  number_of_cols: number,\n  n_batch: number,\n  ones: boolean = true\n) {\n\n  sheet.getCell(cursorrow, cursorcol).setValue(header);\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setSize(12);\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setBold(true);\n\n  sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n\n  cursorrow += 1;\n  let formula_ = ``;\n  let n_rows_withones = 1;\n  // formula_ = `=IF(${in_range.getAddress()}>0, ${in_range.getAddress()}, 0)`;\n  if (ones){\n        formula_ = `=VSTACK(WRAPCOLS(TOCOL(${in_range.getAddress()},1,TRUE),${number_of_rows}*${number_of_cols}), SEQUENCE(1,${n_batch})*0+1)`;\n          n_rows_withones=1;\n  }\n  else{\n    formula_ = `=WRAPCOLS(TOCOL(${in_range.getAddress()},1,TRUE),${number_of_rows}*${number_of_cols})`;\n    n_rows_withones = 0;\n  }\n  \n  sheet\n    .getCell(cursorrow, cursorcol)\n    .setFormula(formula_);\n\n    const range = doConditionalFormatting(sheet,\n    cursorrow, cursorcol, \n    number_of_rows * number_of_cols + 1 * n_rows_withones,\n    n_batch, \n    \"dimgray\", \"WhiteSmoke\", \n    true, false,\n    ones);\n\n  cursorrow += number_of_rows * number_of_cols+2;\n\n  return { row: cursorrow, col: cursorcol, range };\n\n}\n\n\n\n// // ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:LinearOps ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\n// function LinearOps(\n//     workbook: ExcelScript.Workbook,\n//     sheet: ExcelScript.Worksheet,\n//     header: string,\n//     cursorrow: number,\n//     cursorcol: number,\n//     in_range: ExcelScript.Range,\n//     number_of_rows: number,\n//     number_of_cols: number,\n//     ones: boolean = true\n// ) {\n\n//     sheet.getCell(cursorrow, cursorcol).setValue(header);\n//     sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n\n//     cursorrow += 1;\n//     let formula_ = ``;\n\n//     formula_ = `=IF(${in_range.getAddress()}>0, ${in_range.getAddress()}, 0)`;\n\n//     formula_ = ones ? `=VSTACK(${formula_.substring(1)}, SEQUENCE(1,${number_of_cols})*0+1)` : formula_;\n//     let n_rows_withones = ones ? 1 : 0;\n\n//     sheet\n//         .getCell(cursorrow, cursorcol)\n//         .setFormula(formula_);\n\n//     // const range = doFormatting(sheet, cursorrow, cursorcol, number_of_rows + 1 * n_rows_withones, number_of_cols, \"#d5a6bd\");\n//     const range = doConditionalFormatting(sheet,\n//         cursorrow, cursorcol,\n//         number_of_rows + 1 * n_rows_withones,\n//         number_of_cols,\n//         \"CornflowerBlue\", \"Tomato\",\n//         true,\n//         false,\n//         ones);\n\n//     cursorrow += number_of_rows + 1 + 1 * n_rows_withones;\n\n\n//     // const d2 = out_dim;\n//     // const d2 = dim_value;\n//     // console.log(d1)\n//     // const range1 = workbook.getNamedItem(input_var_name).getRange();\n//     const d1 = range.getRowCount();\n//     // console.log(d1)\n//     cursorcol = cursorcol - (d1 + 1);\n//     cursor = drawMatrix(sheet, \"Wb\", cursorrow, cursorcol, number_of_rows, number_of_cols, \"random\");\n//     updateName(workbook, cursor, \"Wb\");\n//     cursor.row = cursor.row - (d2 + 2);\n//     cursor.col = cursor.col + (d1 + 1);\n//     const range2 = workbook.getNamedItem(\"Wb\").getRange();\n//     cursor = multMatricesWithRand(sheet, range2, range, number_of_rows, number_of_cols, number_of_cols, changeTitle2(output_var_name, operation, input_var_name), cursor.row, cursor.col);\n//     cursor.col = cursor.col - (d1 + 1);\n\n\n\n//     return { row: cursorrow, col: cursorcol, range };\n\n// }\n\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:ReLU ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction ReLU(sheet: ExcelScript.Worksheet,\n  header: string,\n  cursorrow: number,\n  cursorcol: number,\n  in_range: ExcelScript.Range,\n  number_of_rows: number,\n  number_of_cols: number,\n  ones: boolean = true\n) {\n\n  sheet.getCell(cursorrow, cursorcol).setValue(header);\n  sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setSize(12);\n  sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setBold(true);\n\n  sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n\n  cursorrow += 1;\n  let formula_ = ``;\n\n  formula_ = `=IF(${in_range.getAddress()}>0, ${in_range.getAddress()}, 0)`;\n\n  formula_ = ones ? `=VSTACK(${formula_.substring(1)}, SEQUENCE(1,${number_of_cols})*0+1)` : formula_;\n  let n_rows_withones = ones ? 1 : 0;\n\n  sheet\n    .getCell(cursorrow, cursorcol)\n    .setFormula(formula_);\n\n  // const range = doFormatting(sheet, cursorrow, cursorcol, number_of_rows + 1 * n_rows_withones, number_of_cols, \"#d5a6bd\");\n    const range = doConditionalFormatting(sheet,\n    cursorrow, cursorcol,\n    number_of_rows + 1 * n_rows_withones,\n    number_of_cols,\n      \"CornflowerBlue\", \"Tomato\",\n    true,\n    false,\n    ones);\n    \n  cursorrow += number_of_rows + 1 + 1 * n_rows_withones;\n\n  return { row: cursorrow, col: cursorcol, range };\n\n}\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:LayerNorm ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction LayerNorm(sheet: ExcelScript.Worksheet,\n    header: string,\n    cursorrow: number,\n    cursorcol: number,\n    in_range: ExcelScript.Range,\n    number_of_rows: number,\n    number_of_cols: number,\n    ones: boolean = true\n) {\n\n    sheet.getCell(cursorrow, cursorcol).setValue(\"Mean\");\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setSize(12);\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setBold(true);\n\n    sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n\n    cursorrow += 1;\n    let formula_ = ``;\n    formula_ = `=BYCOL(${in_range.getAddress()}, LAMBDA(col, AVERAGE(col)))`;\n    sheet\n        .getCell(cursorrow, cursorcol)\n        .setFormula(formula_);\n\n    const range1 = doConditionalFormatting(sheet,\n    cursorrow, cursorcol,\n    1, number_of_cols, \n      \"ForestGreen\", \"PaleGreen\");\n\n    cursorrow += 1;\n\n    sheet.getCell(cursorrow, cursorcol).setValue(\"Std\");\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setSize(12);\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setBold(true);\n\n    sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n\n    cursorrow += 1;\n    formula_ = `=BYCOL(${in_range.getAddress()}, LAMBDA(col, STDEV.S(col)))`;\n    sheet\n        .getCell(cursorrow, cursorcol)\n        .setFormula(formula_);\n\n    const range2 = doConditionalFormatting(sheet,\n    cursorrow, cursorcol,\n    1, number_of_cols, \n      \"ForestGreen\", \"PaleGreen\");\n\n    cursorrow += 1;\n\n\n\n    sheet.getCell(cursorrow, cursorcol).setValue(header);\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setSize(12);\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setBold(true);\n\n    sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n    cursorrow += 1;\n\n    formula_ = `=(${in_range.getAddress()} - ${range1.getAddress()})/(${range2.getAddress()} - 0.00000001)`;\n    formula_ = ones ? `=VSTACK(${formula_.substring(1)}, SEQUENCE(1,${number_of_cols})*0+1)` : formula_;\n    let n_rows_withones = ones ? 1 : 0;\n    sheet\n        .getCell(cursorrow, cursorcol)\n        .setFormula(formula_);\n\n  // const range = doFormatting(sheet, cursorrow, cursorcol, number_of_rows + 1 * n_rows_withones, number_of_cols, \"#d5a6bd\");\n    const range = doConditionalFormatting(sheet, \n    cursorrow, cursorcol, \n    number_of_rows + 1 * n_rows_withones, \n    number_of_cols,\n      \"CornflowerBlue\", \"Tomato\",\n        true,\n        false,\n        ones);\n\n  cursorrow += number_of_rows + 1 + 1 * n_rows_withones;\n\n    return { row: cursorrow, col: cursorcol, range };\n\n}\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:L1Normalization ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction L1Normalization(sheet: ExcelScript.  Worksheet,\n    header: string,\n    cursorrow: number,\n    cursorcol: number,\n    in_range: ExcelScript.Range,\n    number_of_rows: number,\n    number_of_cols: number,\n) {\n\n    sheet.getCell(cursorrow, cursorcol).setValue(\"L1\");\n    sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n\n    cursorrow += 1;\n    let formula_ = ``;\n    formula_ = `=BYCOL(${in_range.getAddress()}, LAMBDA(col, SUMPRODUCT(ABS(col))))`;\n    sheet\n        .getCell(cursorrow, cursorcol)\n        .setFormula(formula_);\n\n    const range_ = doFormatting(sheet, cursorrow, cursorcol, 1, number_of_cols, \"#fff2cc\");\n    cursorrow += 2;\n\n\n    sheet.getCell(cursorrow, cursorcol).setValue(header);\n    sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n    cursorrow += 1;\n    // console.log(range.getAddress());\n    // let formula_ = ``;\n    formula_ = `=${in_range.getAddress()}/IF(${range_.getAddress()}=0,1, ${range_.getAddress()})`;\n    sheet\n        .getCell(cursorrow, cursorcol)\n        .setFormula(formula_);\n\n    const range = doFormatting(sheet, cursorrow, cursorcol, number_of_rows, number_of_cols, \"#fff2cc\");\n    cursorrow += number_of_rows + 1;\n\n    return { row: cursorrow, col: cursorcol, range };\n\n}\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:L2Normalization ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction L2Normalization(sheet: ExcelScript.Worksheet,\n    header: string,\n    cursorrow: number,\n    cursorcol: number,\n    in_range: ExcelScript.Range,\n    number_of_rows: number,\n    number_of_cols: number,\n) {\n\n    sheet.getCell(cursorrow, cursorcol).setValue(\"L2\");\n    sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n\n    cursorrow += 1;\n    let formula_ = ``;\n    formula_ = `=BYCOL(${in_range.getAddress()}, LAMBDA(col, SQRT(SUM(col^2))))`;\n    sheet\n        .getCell(cursorrow, cursorcol)\n        .setFormula(formula_);\n\n    const range_ = doFormatting(sheet, cursorrow, cursorcol, 1, number_of_cols, \"#ffa7cc\");\n    cursorrow += 2;\n\n\n    sheet.getCell(cursorrow, cursorcol).setValue(header);\n    sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n    cursorrow += 1;\n    // console.log(range.getAddress());\n    // let formula_ = ``;\n    formula_ = `=${in_range.getAddress()}/IF(${range_.getAddress()}=0,1, ${range_.getAddress()})`;\n    sheet\n        .getCell(cursorrow, cursorcol)\n        .setFormula(formula_);\n\n    const range = doFormatting(sheet, cursorrow, cursorcol, number_of_rows, number_of_cols, \"#ffa7cc\");\n    cursorrow += number_of_rows + 1;\n\n    return { row: cursorrow, col: cursorcol, range };\n\n}\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:softmax ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction softmax(sheet: ExcelScript.Worksheet,\n    header: string,\n    cursorrow: number,\n    cursorcol: number,\n    in_range: ExcelScript.Range,\n    number_of_rows: number,\n    number_of_cols: number,\n    ones: boolean = true\n) {\n\n    sheet.getCell(cursorrow, cursorcol).setValue(\"Exp\");\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setSize(12);\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setBold(true);\n\n    \n    sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n\n    cursorrow += 1;\n    let formula_ = ``;\n    formula_ = `=EXP(${in_range.getAddress()})`;\n    sheet\n        .getCell(cursorrow, cursorcol)\n        .setFormula(formula_);\n\n    // const range1 = doFormatting(sheet, cursorrow, cursorcol, number_of_rows, number_of_cols, \"#fff2cc\");\n    // cursorrow += number_of_rows + 1;\n    const range1 = doConditionalFormatting(sheet,\n        cursorrow, cursorcol,\n        number_of_rows, number_of_cols,\n        \"ForestGreen\", \"PaleGreen\");\n    cursorrow += number_of_rows + 1;\n    // cursorrow += 1;\n    sheet.getCell(cursorrow, cursorcol).setValue(\"Sum (Exp)\");\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setSize(12);\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setBold(true);\n\n    sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n\n    cursorrow += 1;\n    // let formula_ = ``;\n    formula_ = `=BYCOL(${range1.getAddress()}, LAMBDA(col, SUM(col)))`;\n    sheet\n        .getCell(cursorrow, cursorcol)\n        .setFormula(formula_);\n\n    // const range2 = doFormatting(sheet, cursorrow, cursorcol, 1, number_of_cols, \"#fff2cc\");\n    // cursorrow += 2;\n\n    const range2 = doConditionalFormatting(sheet,\n        cursorrow, cursorcol,\n        1, number_of_cols,\n        \"ForestGreen\", \"PaleGreen\");\n    cursorrow += 2;\n\n    sheet.getCell(cursorrow, cursorcol).setValue(header);\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setSize(12);\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setBold(true);\n\n    sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n    // let formula_ = ``;\n    cursorrow += 1;\n\n    formula_ = `=${range1.getAddress()}/${range2.getAddress()}`;\n\n    formula_ = ones ? `=VSTACK(${formula_.substring(1)}, SEQUENCE(1,${number_of_cols})*0+1)` : formula_;\n    let n_rows_withones = ones ? 1 : 0;\n\n\n    sheet\n        .getCell(cursorrow, cursorcol)\n        .setFormula(formula_);\n\n    // const range = doFormatting(sheet, cursorrow, cursorcol, number_of_rows, number_of_cols, \"#fff2cc\");\n    // cursorrow += number_of_rows + 1;\n\n    const range = doConditionalFormatting(sheet,\n        cursorrow, cursorcol,\n        number_of_rows + 1 * n_rows_withones,\n        number_of_cols,\n        \"CornflowerBlue\", \"Tomato\",\n        true,\n        false,\n        ones);\n\n\n    cursorrow += number_of_rows + 1 + 1 * n_rows_withones;\n\n\n    return { row: cursorrow, col: cursorcol, range };\n\n}\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:drawXwithText ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction drawXwithText(\n    sheet: ExcelScript.Worksheet,\n    header: string,\n    extractedString: string,\n    cursorrow: number,\n    cursorcol: number,\n    number_of_rows: number,\n    number_of_cols: number\n) {\n    sheet.getCell(cursorrow, cursorcol).setValue(header);\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setSize(12);\n\n    sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n\n    cursorrow += 1;\n\n    const charCount = extractedString.length;\n\n    for (let i = 0; i < charCount; i++) {\n        const cell = sheet.getCell(cursorrow, cursorcol + i); // zero-indexed\n        cell.setValue(extractedString[i]);\n    }\n    const range2 = doFormatting(sheet, cursorrow, cursorcol, number_of_rows, number_of_cols, \"#f6b26b\");\n    cursorrow += number_of_rows + 1;\n\n    sheet.getCell(cursorrow, cursorcol).setValue(\"Token ID\")\n    sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n    cursorrow += 1;\n    const formula_ = `=CODE(LOWER(${range2.getAddress()}))- CODE(\"a\")`;\n    sheet\n        .getCell(cursorrow, cursorcol)\n        .setFormula(formula_);\n    const range = doFormatting(sheet, cursorrow, cursorcol, number_of_rows, number_of_cols, \"white\");\n    cursorrow += number_of_rows + 1;\n    return { row: cursorrow, col: cursorcol, range }\n}\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:transposeMatrix ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction transposeMatrix(\n    sheet: ExcelScript.Worksheet,\n    in_range: ExcelScript.Range,\n    header: string,\n    var_name: string,\n    cursorrow: number,\n    cursorcol: number,\n    number_of_rows: number,\n    number_of_cols: number\n) {\n    sheet.getCell(cursorrow, cursorcol).setValue(header);\n    sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n\n    cursorrow += 1;\n    const formula_ = `=TRANSPOSE(${in_range.getAddress()})`;\n    sheet\n        .getCell(cursorrow, cursorcol)\n        .setFormula(formula_);\n    const range = doFormatting(sheet, cursorrow, cursorcol, number_of_rows, number_of_cols, \"#daf2d1\");\n    cursorrow += number_of_rows + 1;\n\n    return { row: cursorrow, col: cursorcol, range };\n}\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:add2Matrices ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction add2Matrices(\n    sheet: ExcelScript.Worksheet,\n    range1: ExcelScript.Range,\n    range2: ExcelScript.Range,\n    header: string,\n    cursorrow: number,\n    cursorcol: number,\n    number_of_rows: number,\n    number_of_cols: number\n) {\n    sheet.getCell(cursorrow, cursorcol).setValue(header);\n    sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n\n    cursorrow += 1;\n    const formula_ = `=${range1.getAddress()}+${range2.getAddress()}`;\n    sheet\n        .getCell(cursorrow, cursorcol)\n        .setFormula(formula_);\n    const range = doFormatting(sheet, cursorrow, cursorcol, number_of_rows, number_of_cols, \"#cfe2f3\");\n    cursorrow += number_of_rows + 1;\n\n    return { row: cursorrow, col: cursorcol, range };\n}\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:multMatricesWithRand ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction multMatricesWithRand(\n    sheet: ExcelScript.Worksheet,\n    range1: ExcelScript.Range,\n    range2: ExcelScript.Range,\n    indim: number,\n    outdim: number,\n    outcols: number,\n    header: string,\n    cursorrow: number,\n    cursorcol: number,\n    ones: boolean =false\n) {\n    const number_of_rows = outdim;\n    const number_of_cols = indim;\n\n    sheet.getCell(cursorrow, cursorcol).setValue(header);\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setSize(12);\n\n    sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n\n    cursorrow += 1;\n    const formula_ = `=MMULT(${range1.getAddress()},${range2.getAddress()})`;\n\n\n\n    sheet\n        .getCell(cursorrow, cursorcol)\n        .setFormula(formula_);\n    // const range = doFormatting(sheet, cursorrow, cursorcol, number_of_rows, outcols, \"#DABBFC\");\n\n    \n    const range = doConditionalFormatting(sheet,\n    cursorrow, cursorcol, \n    number_of_rows, outcols,\n      \"CornflowerBlue\", \"Tomato\",\n        true,\n        false,\n        ones);\n\n    cursorrow += number_of_rows + 1;\n\n    return { row: cursorrow, col: cursorcol, range };\n}\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:multMatricesWithRand2 ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction multMatricesWithRand2(\n    sheet: ExcelScript.Worksheet,\n    range1: ExcelScript.Range,\n    range2: ExcelScript.Range,\n    indim: number,\n    outdim: number,\n    outcols: number,\n    header: string,\n    cursorrow: number,\n    cursorcol: number,\n    ones: boolean = false\n) {\n    const number_of_rows = outdim;\n    const number_of_cols = indim;\n\n    sheet.getCell(cursorrow, cursorcol).setValue(header);\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setSize(12);\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setBold(true);\n\n    sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n\n    let formula_ = ``;\n\n    cursorrow += 1;\n    formula_ = `=MMULT(${range1.getAddress()},${range2.getAddress()})`;\n\n    formula_ = ones ? `=VSTACK(${formula_.substring(1)}, SEQUENCE(1,${outcols})*0+1)` : formula_;\n    let n_rows_withones = ones ? 1 : 0;\n\n\n\n    sheet\n        .getCell(cursorrow, cursorcol)\n        .setFormula(formula_);\n    // const range = doFormatting(sheet, cursorrow, cursorcol, number_of_rows, outcols, \"#DABBFC\");\n\n\n    const range = doConditionalFormatting(sheet,\n        cursorrow, cursorcol,\n      number_of_rows + 1 * n_rows_withones, outcols,\n      \"CornflowerBlue\", \"Tomato\",\n        true,\n        false,\n        ones);\n\n    // cursorrow += number_of_rows + 1;\n    cursorrow += number_of_rows + 1 + 1 * n_rows_withones;\n\n    return { row: cursorrow, col: cursorcol, range };\n}\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:getDatasetInfo ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction getDatasetInfo(\n    workbook: ExcelScript.Workbook,\n    datasetName: string,\n){\n    // console.log(datasetName)\n    // const datasetSheet = workbook.getWorksheet(datasetName);\n    const info_range = workbook.getNamedItem(datasetName+\"Info\").getRange();\n    const values = info_range.getValues();  // 2D array\n\n    let dict: { [key: string]: string | number } = {};\n\n    for (let i = 0; i < values.length; i++) {\n        const key = String(values[i][0]);  // always convert to string\n        const val = values[i][1];\n\n        dict[key] = (typeof val === \"number\") ? val : String(val);\n    }\n\n    // console.log(dict);\n\n    return dict;\n}\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:mult2Matrices ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction mult2Matrices(\n    sheet: ExcelScript.Worksheet,\n    range1: ExcelScript.Range,\n    range2: ExcelScript.Range,\n    indim: number,\n    outdim: number,\n    outcols: number,\n    header: string,\n    cursorrow: number,\n    cursorcol: number,\n) {\n    const number_of_rows = outdim;\n    const number_of_cols = indim;\n\n    sheet.getCell(cursorrow, cursorcol).setValue(header);\n    sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n\n    cursorrow += 1;\n    const formula_ = `=MMULT(${range1.getAddress()},${range2.getAddress()})`;\n    sheet\n        .getCell(cursorrow, cursorcol)\n        .setFormula(formula_);\n    // const range = doFormatting(sheet, cursorrow, cursorcol, number_of_rows, outcols, \"#DABBFC\");\n    const range = doConditionalFormatting(sheet, \n    cursorrow, cursorcol, \n    number_of_rows, outcols);\n\n    cursorrow += number_of_rows + 1;\n\n    return { row: cursorrow, col: cursorcol, range };\n}\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:changeTitle ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction changeTitle(\n    ops_string: string,\n    var_string: string\n) {\n    let out_string = \"\";\n    out_string = ops_string + \"(\" + var_string + \")\";\n    return out_string;\n}\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:changeTitle2 ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction changeTitle2(\n    out_var: string,\n    ops_string: string,\n    var_string: string\n) {\n    let out_string = \"\";\n    out_string = out_var + \" = \" + ops_string + \" (\" + var_string + \")\";\n    return out_string;\n}\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:drawShape ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction drawShape(\n    sheet: ExcelScript.Worksheet,\n    text: string,\n    posW: number,\n    posH: number,\n    shapeW: number,\n    shapeH: number\n\n) {\n    const shape = sheet.addGeometricShape(ExcelScript.GeometricShapeType.roundRectangle);\n    shape.setName(\"in\");\n    shape.setLeft(posW);\n    shape.setTop(posH);\n    shape.setWidth(shapeW);\n    shape.setHeight(shapeH);\n    shape.getFill().setSolidColor(\"lightblue\");\n    shape.getTextFrame().getTextRange().setText(text);\n    shape.getTextFrame().getTextRange().getFont().setColor(\"black\")\n    shape.getTextFrame().getTextRange().getFont().setSize(8);\n    shape.getTextFrame().setHorizontalAlignment(ExcelScript.ShapeTextHorizontalAlignment.center);\n    shape.getTextFrame().setVerticalAlignment(ExcelScript.ShapeTextVerticalAlignment.middle);\n\n    shape.getLineFormat().setWeight(0);\n}\n\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:drawObject ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction drawObject(\n    sheet: ExcelScript.Worksheet,\n    text: string,\n    posW: number,\n    posH: number,\n    shapeW: number,\n    shapeH: number,\n    previousShape?: ExcelScript.Shape,\n) {\n\n    const shape = sheet.addGeometricShape(ExcelScript.GeometricShapeType.roundRectangle);\n    // shape.setName(\"in\");\n    shape.setLeft(posW);\n    shape.setTop(posH);\n    shape.setWidth(shapeW);\n    shape.setHeight(shapeH);\n    shape.getFill().setSolidColor(\"lightblue\");\n    shape.getTextFrame().getTextRange().setText(text);\n    shape.getTextFrame().getTextRange().getFont().setColor(\"black\")\n    shape.getTextFrame().getTextRange().getFont().setSize(8);\n    shape.getTextFrame().setHorizontalAlignment(ExcelScript.ShapeTextHorizontalAlignment.center);\n    shape.getTextFrame().setVerticalAlignment(ExcelScript.ShapeTextVerticalAlignment.middle);\n\n\n    return shape;\n}\n\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:shapeConnector ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction shapeConnector(\n    sheet: ExcelScript.Worksheet,\n    shape0name: string,\n    shape1name: string,\n) {\n    const allShapes = sheet.getShapes();\n    const previousShape = allShapes.find(s => s.getName() === shape0name);\n    const shape = allShapes.find(s => s.getName() === shape1name);\n\n    // Arrow from Start to Input\n    const arrow1 = sheet.addLine(0, 0, 10, 10, ExcelScript.ConnectorType.curve);\n\n    arrow1.getLineFormat().setColor(\"black\");\n    arrow1.getLineFormat().setWeight(1);\n    arrow1.getLineFormat().setDashStyle(ExcelScript.ShapeLineDashStyle.systemDot);\n\n    arrow1.getLine().setBeginArrowheadStyle(ExcelScript.ArrowheadStyle.oval)\n    arrow1.getLine().connectBeginShape(previousShape, 3);  // Left side\n\n    arrow1.getLine().setEndArrowheadStyle(ExcelScript.ArrowheadStyle.stealth)\n    arrow1.getLine().connectEndShape(shape, 1); // Right sidend\n\n\n}\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:drawBlockBorder ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction drawBlockBorder(\n    blockID: number,\n    sheet: ExcelScript.Worksheet,\n    input_var_name: string,\n    blockheader: string,\n    cursorrow: number,\n    cursorcol: number\n) {\n    // cursorcol-=1;\n    const number_of_cols = 20;\n    const number_of_rows = 1;\n    sheet.getCell(cursorrow, cursorcol).setValue(\"# \" + (blockID + 1));\n    sheet.getCell(cursorrow, cursorcol).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n    sheet.getCell(cursorrow, cursorcol + 1).setValue(\" \" + blockheader);\n    sheet.getCell(cursorrow, cursorcol + 1).getFormat().setHorizontalAlignment(ExcelScript.HorizontalAlignment.left);\n    sheet.getCell(cursorrow, cursorcol + 1).getFormat().getFont().setColor(\"gray\");\n    sheet.getCell(cursorrow, cursorcol + 1).getFormat().getFont().setItalic(true);\n\n\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setSize(8);\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFont().setColor(\"white\");\n    sheet.getCell(cursorrow, cursorcol).getFormat().getFill().setColor(\"black\");\n\n\n    const range = sheet.getRange(\n        convertToA1(cursorrow, cursorcol) + \":\" + convertToA1(cursorrow + number_of_rows - 1, cursorcol + number_of_cols - 1)\n    );\n\n    const fmt = range.getFormat();\n    const borders = [\n        ExcelScript.BorderIndex.edgeTop,\n    ];\n\n    for (let b of borders) {\n        fmt.getRangeBorder(b).setStyle(ExcelScript.BorderLineStyle.none);\n    }\n\n\n    return range;\n}\n\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:doneMessage ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction doneMessage(\n    blockID: number,\n    sheet: ExcelScript.Worksheet,\n    colID: number\n) {\n    const rowID = blockID + 1;\n    sheet.getCell(rowID, colID).setValue(\"âœ“\");\n\n}\n\nfunction fullCompleteMessage(\n    sheet: ExcelScript.Worksheet,\n    rowID: number,\n    colID: number\n) {\n    sheet.getCell(rowID, colID).setValue(\"ðŸ‘‡ Check ABH sheet.\");\n    sheet.getCell(rowID, colID).getFormat().getFont().setColor(\"gray\");\n    sheet.getCell(rowID, colID).getFormat().getFont().setName(\"Ink Free\");\n    sheet.getCell(rowID, colID).getFormat().getFont().setSize(8);\n    sheet.getCell(rowID, colID).getFormat().getFont().setBold(true);\n\n\n}\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:lookUp ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction lookUp() {\n\n    const lookup: { [key: string]: [number, number, number] } = {};\n\n    lookup[\"A\"] = [0.082, 0.078, 4.338];\n    lookup[\"B\"] = [0.015, 0.02, 2.849];\n    lookup[\"C\"] = [0.028, 0.04, 2.849];\n    lookup[\"D\"] = [0.043, 0.038, 2.964];\n    lookup[\"E\"] = [0.127, 0.11, 3.383];\n    lookup[\"F\"] = [0.022, 0.014, 2.612];\n    lookup[\"G\"] = [0.02, 0.03, 2.494];\n    lookup[\"H\"] = [0.061, 0.023, 2.612];\n    lookup[\"I\"] = [0.07, 0.086, 3.383];\n    lookup[\"J\"] = [0.0015, 0.0021, 2.964];\n    lookup[\"K\"] = [0.0077, 0.0097, 3.545];\n    lookup[\"L\"] = [0.04, 0.053, 4.338];\n    lookup[\"M\"] = [0.024, 0.027, 3.772];\n    lookup[\"N\"] = [0.067, 0.072, 3.196];\n    lookup[\"O\"] = [0.075, 0.061, 4.043];\n    lookup[\"P\"] = [0.019, 0.028, 4.889];\n    lookup[\"Q\"] = [0.00095, 0.0019, 4.889];\n    lookup[\"R\"] = [0.06, 0.073, 2.934];\n    lookup[\"S\"] = [0.063, 0.087, 3.545];\n    lookup[\"T\"] = [0.091, 0.067, 2.707];\n    lookup[\"U\"] = [0.028, 0.033, 2.934];\n    lookup[\"V\"] = [0.0098, 0.01, 2.732];\n    lookup[\"W\"] = [0.024, 0.0091, 4.043];\n    lookup[\"X\"] = [0.0015, 0.0027, 3.196];\n    lookup[\"Y\"] = [0.02, 0.016, 2.707];\n    lookup[\"Z\"] = [0.00074, 0.0044, 3.772];\n\n    return lookup;\n\n}\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:dropDown ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction dropDown(\n    // sheet: ExcelScript.Worksheet,\n    range: ExcelScript.Range,\n    rowID: number,\n    colID: number\n) {\n\n\n    const options = [\"TRUE\", \"FALSE\"];\n\n    // Apply data validation\n    const validation = range.getDataValidation();\n    validation.setRule({\n        list: {\n            inCellDropDown: true,\n            source: options.join(\",\") // comma-separated string\n        }\n    });\n\n    // Optional: Set a default value\n    range.getCell(rowID, colID).setValue(\"TRUE\");\n\n}\n\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:writeCode ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction writeCode(\n    sheet: ExcelScript.Worksheet,\n    // range: ExcelScript.Range,\n    // input_var_name: string,\n    cursorrow: number,\n    cursorcol: number,\n    number_of_rows: number,\n    number_of_cols: number\n) {\n    // Get the active worksheet\n    // let sheet = workbook.getActiveWorksheet();\n\n    // Change this to your range\n    // let range = sheet.getRange(\"A1:G1\"); // assuming numbers are in row 1, columns A to G\n    const range = sheet.getRangeByIndexes(cursorrow, cursorcol, number_of_rows, number_of_cols);\n    // Get values from the range\n    let values = range.getValues()[0]; // [0] for the first row\n\n    let numbersStr = values.map(v => v.toString()).join(\", \");\n\n    let resultStr = `X = torch.tensor([${numbersStr}])`;\n\n    // Output to immediate cell (you can change location)\n    // sheet.getCell(2, 0).setValue(resultStr); // outputs in A3\n    console.log(resultStr);\n}\n\n\n\n\n// ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª Fn:getCode ðŸŸ¨ðŸŸªðŸŸ¨ðŸŸª\n\nfunction getCode(\n    // sheet: ExcelScript.Worksheet,\n    range: ExcelScript.Range,\n    input_var_name: string,\n    output_var_name: string,\n    cursorrow: number,\n    cursorcol: number,\n    number_of_rows: number,\n    number_of_cols: number\n) {\n\n    let values = range.getValues()[0]; // [0] for the first row\n\n    let numbersStr = values.map(v => v.toString()).join(\", \");\n\n    let resultStr = `${output_var_name} = torch.tensor([${numbersStr}])`;\n\n\n    return resultStr;\n}\n\n","description":"","noCodeMetadata":"","parameterInfo":"{\"version\":1,\"originalParameterOrder\":[],\"parameterSchema\":{\"type\":\"object\",\"default\":{},\"x-ms-visibility\":\"internal\"},\"returnSchema\":{\"type\":\"object\",\"properties\":{}},\"signature\":{\"comment\":\"\",\"parameters\":[{\"name\":\"workbook\",\"comment\":\"\"}]}}","apiInfo":"{\"variant\":\"synchronous\",\"variantVersion\":2}"}